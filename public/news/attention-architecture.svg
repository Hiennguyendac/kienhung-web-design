<svg xmlns="http://www.w3.org/2000/svg" width="1100" height="340" viewBox="0 0 1100 340" fill="none">
  <style>
    .title{font-family:'Inter', system-ui, -apple-system, sans-serif;font-size:16px;font-weight:700;fill:#0f172a;}
    .label{font-family:'Inter', system-ui, -apple-system, sans-serif;font-size:13px;fill:#1e293b;}
    .muted{fill:#475569;}
  </style>
  <rect width="1100" height="340" rx="16" fill="#f8fafc"/>
  <text x="28" y="36" class="title">Self-Attention trong kiến trúc Encoder-Decoder</text>
  <text x="28" y="58" class="label muted">Mỗi token được chiếu sang Q, K, V → tính điểm tương đồng → softmax → vector ngữ cảnh</text>

  <g transform="translate(40,110)">
    <rect x="0" y="0" width="160" height="120" rx="14" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="1.5"/>
    <text x="80" y="70" text-anchor="middle" class="title" font-size="15">Encoder</text>
    <text x="80" y="92" text-anchor="middle" class="label muted">(hidden states h1..hn)</text>
  </g>

  <g transform="translate(240,92)">
    <rect x="0" y="0" width="200" height="156" rx="16" fill="#eef2ff" stroke="#6366f1" stroke-width="1.5"/>
    <text x="100" y="26" text-anchor="middle" class="title" font-size="15">Projection</text>
    <text x="60" y="74" text-anchor="middle" class="label">Q = hWq</text>
    <text x="140" y="74" text-anchor="middle" class="label">K = hWk</text>
    <text x="100" y="110" text-anchor="middle" class="label">V = hWv</text>
  </g>

  <g transform="translate(480,70)">
    <rect x="0" y="0" width="200" height="200" rx="18" fill="#fef9c3" stroke="#f59e0b" stroke-width="1.5"/>
    <text x="100" y="24" text-anchor="middle" class="title" font-size="15">Scaled Dot-Product</text>
    <text x="100" y="46" text-anchor="middle" class="label muted">scores = QKᵀ / √d</text>
    <rect x="26" y="70" width="148" height="30" rx="8" fill="#fde68a" stroke="#f59e0b"/>
    <text x="100" y="91" text-anchor="middle" class="label">Score Matrix</text>
    <text x="100" y="126" text-anchor="middle" class="label muted">softmax(scores)</text>
    <rect x="26" y="142" width="148" height="30" rx="8" fill="#fef3c7" stroke="#f59e0b"/>
    <text x="100" y="163" text-anchor="middle" class="label">Attention Weights</text>
  </g>

  <g transform="translate(720,92)">
    <rect x="0" y="0" width="180" height="156" rx="16" fill="#ecfdf3" stroke="#22c55e" stroke-width="1.5"/>
    <text x="90" y="26" text-anchor="middle" class="title" font-size="15">Weighted Sum</text>
    <text x="90" y="50" text-anchor="middle" class="label muted">context = weights · V</text>
    <rect x="22" y="74" width="136" height="30" rx="8" fill="#d9f99d" stroke="#22c55e"/>
    <text x="90" y="94" text-anchor="middle" class="label">Context Vector</text>
    <text x="90" y="124" text-anchor="middle" class="label muted">đẩy sang Decoder</text>
  </g>

  <g transform="translate(930,110)">
    <rect x="0" y="0" width="140" height="120" rx="14" fill="#e0f2fe" stroke="#0ea5e9" stroke-width="1.5"/>
    <text x="70" y="70" text-anchor="middle" class="title" font-size="15">Decoder</text>
    <text x="70" y="92" text-anchor="middle" class="label muted">(predict token tᵢ)</text>
  </g>

  <!-- arrows -->
  <defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="10" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#0f172a"/>
    </marker>
  </defs>
  <g stroke="#0f172a" stroke-width="1.4" marker-end="url(#arrow)" fill="none">
    <path d="M200 170 L240 170" />
    <path d="M440 170 L480 170" />
    <path d="M680 170 L720 170" />
    <path d="M900 170 L930 170" />
  </g>

  <!-- multi-head hint -->
  <rect x="480" y="282" width="220" height="44" rx="12" fill="#e2e8f0" stroke="#94a3b8"/>
  <text x="590" y="308" text-anchor="middle" class="label" fill="#0f172a">Multi-Head = lặp nhiều block và concat</text>
</svg>
